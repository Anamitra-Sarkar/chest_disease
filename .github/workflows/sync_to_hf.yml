name: Sync to Hugging Face Space

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Setup Git LFS
        run: |
          git lfs install

      - name: Configure Git
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "GitHub Actions Bot"

      - name: Push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          set -e

          if [ -z "$HF_TOKEN" ]; then
            echo "âŒ HF_TOKEN is not set in GitHub Secrets"
            exit 1
          fi

          # Authenticate with Hugging Face
          git config --global credential.helper store
          echo "https://user:${HF_TOKEN}@huggingface.co" > ~/.git-credentials

          # Add HF remote if missing
          if ! git remote get-url huggingface >/dev/null 2>&1; then
            git remote add huggingface https://huggingface.co/spaces/Arko007/chest-disease
          fi

          echo "ðŸš€ Syncing GitHub â†’ Hugging Face Space..."

          # IMPORTANT:
          # HF Spaces usually track `master`, NOT `main`
          # Push current commit to HF master branch
          git push huggingface HEAD:master

          echo "âœ… Hugging Face Space updated successfully"

      - name: Cleanup credentials
        if: always()
        run: |
          rm -f ~/.git-credentials
